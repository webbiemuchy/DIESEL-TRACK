<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>DIESEL-TRACK | Fleet Management System</title>
  <link rel="stylesheet" href="styles.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</head>
<body>

  <header class="app-header">
    <div class="brand">
      <svg width="32" height="32" viewBox="0 0 24 24" fill="var(--cat-yellow)">
        <path d="M19,8H17V6a1,1,0,0,0-1-1H4A1,1,0,0,0,3,6V18a1,1,0,0,0,1,1H17a1,1,0,0,0,1-1V16h1a1,1,0,0,1,1,1v1a1,1,0,0,0,2,0V17A3,3,0,0,0,19,14V10A2,2,0,0,0,19,8ZM16,17H5V7H16ZM11,9h2v4H11Zm0,5h2v1H11Z"/>
      </svg>
      <h1>Diesel-Track</h1>
    </div>
    
    <nav class="main-nav">
      <button class="nav-link active" data-target="view-refuel">Refueling</button>
      <button class="nav-link" data-target="view-assets">Fleet Assets</button>
      <button class="nav-link" data-target="view-operators">Operators</button>
      <button class="nav-link" data-target="view-analytics">Analytics</button>
      <button class="nav-link" data-target="view-settings">Settings</button>
    </nav>

    <div class="header-actions">
      <span id="status-indicator" class="status-pill">SYSTEM READY</span>
      <button id="btn-export" class="btn btn-secondary btn-sm">Export Excel</button>
      <button id="btn-import-trigger" class="btn btn-secondary btn-sm">Import Excel</button>
      <input type="file" id="file-import" accept=".xlsx, .xls" style="display:none">
    </div>
  </header>

  <main class="app-container">
    
    <section id="view-refuel" class="tab-content active">
      <div class="card">
        <h2>New Refueling Entry</h2>
        <form id="form-refuel" class="inline-form">
          <select id="refuel-machine" required><option value="">Select Machine</option></select>
          <select id="refuel-operator" required><option value="">Select Operator</option></select>
          <input type="number" step="0.1" min="0" id="refuel-usage" placeholder="Hours/KM Work" required>
          <input type="number" step="0.1" min="0" id="refuel-fuel" placeholder="Liters Refilled" required>
          <button type="submit" class="btn btn-primary">Log Entry</button>
        </form>
      </div>

      <div class="card mt-1">
        <h2>Activity History</h2>
        <div class="table-container">
          <table id="table-refuels">
            <thead>
              <tr>
                <th>Timestamp</th>
                <th>Machine</th>
                <th>Operator</th>
                <th>Usage</th>
                <th>Fuel</th>
                <th>Variance</th>
                <th>Status</th>
                <th>Action</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
    </section>

    <section id="view-assets" class="tab-content">
      <div class="card">
        <h2>Add Fleet Asset</h2>
        <form id="form-machine" class="inline-form">
          <input type="text" id="m-id" placeholder="Machine ID (e.g., EX-001)" required>
          <input type="text" id="m-model" placeholder="Model (e.g., CAT 320)" required>
          <input type="number" step="0.1" min="0" id="m-rate" placeholder="Consumption Rate (L/hr)" required>
          <input type="number" step="1" min="1" id="m-capacity" placeholder="Tank Capacity (L)" required>
          <button type="submit" class="btn btn-primary">Add Machine</button>
        </form>
      </div>
      <div class="card mt-1">
        <div class="table-container">
          <table id="table-machines">
            <thead>
              <tr><th>Machine ID</th><th>Model</th><th>Rate (L/U)</th><th>Capacity (L)</th><th>Action</th></tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
    </section>

    <section id="view-operators" class="tab-content">
      <div class="card">
        <h2>Add Operator</h2>
        <form id="form-operator" class="inline-form">
          <input type="text" id="op-name" placeholder="Full Name" required>
          <input type="text" id="op-badge" placeholder="Badge Number" required>
          <button type="submit" class="btn btn-primary">Add Operator</button>
        </form>
      </div>
      <div class="card mt-1">
        <div class="table-container">
          <table id="table-operators">
            <thead>
              <tr><th>Name</th><th>Badge #</th><th>Action</th></tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
    </section>

    <section id="view-analytics" class="tab-content">
      <div class="analytics-grid">
        <!-- Linking Graph (Overall) -->
        <div class="card">
          <div class="chart-header">
            <h2>Overall Fleet Trend</h2>
          </div>
          <div style="height: 300px;"><canvas id="chart-linking"></canvas></div>
        </div>

        <!-- Machine Specific Graph -->
        <div class="card">
          <div class="chart-header">
            <h2>Machine Performance</h2>
            <select id="chart-filter-machine">
              <option value="">All Machines</option>
            </select>
          </div>
          <div style="height: 300px;"><canvas id="chart-machine"></canvas></div>
        </div>

        <!-- Operator Specific Graph -->
        <div class="card">
          <div class="chart-header">
            <h2>Operator Performance</h2>
            <select id="chart-filter-operator">
              <option value="">All Operators</option>
            </select>
          </div>
          <div style="height: 300px;"><canvas id="chart-operator"></canvas></div>
        </div>
      </div>
    </section>

    <section id="view-settings" class="tab-content">
      <div class="card">
        <h2>System Configuration</h2>
        <form id="form-settings">
          <div class="form-group">
            <label>Anomaly Detection Threshold (%)</label>
            <input type="number" id="set-tolerance" value="10" min="0" max="100" step="1">
            <small class="form-help">Alert when fuel usage exceeds expected consumption by this percentage</small>
          </div>
          <button type="submit" class="btn btn-primary">Save Settings</button>
        </form>
      </div>

      <div class="card mt-1">
        <h2>Data Management</h2>
        <div class="settings-grid">
          <div class="setting-item">
            <h3>Backup & Restore</h3>
            <p>Create a backup of all data to browser storage. Auto-backup runs every 5 minutes.</p>
            <div id="backup-info" class="backup-info-container"></div>
            <div class="button-group">
              <button id="btn-backup" class="btn btn-secondary">Create Backup Now</button>
              <button id="btn-restore" class="btn btn-secondary">Restore from Browser</button>
            </div>
            <div class="button-group mt-1">
              <button id="btn-download-backup" class="btn btn-primary btn-sm">Download Backup File</button>
              <button id="btn-upload-backup" class="btn btn-primary btn-sm">Upload Backup File</button>
              <input type="file" id="file-backup" accept=".json" style="display:none">
            </div>
          </div>
          <div class="setting-item">
            <h3>Reset System</h3>
            <p>Permanently delete all data including machines, operators, and refuel logs. This action cannot be undone!</p>
            <button id="btn-reset" class="btn btn-danger">Wipe All Data</button>
          </div>
        </div>
      </div>

      <div class="card mt-1">
        <h2>System Information</h2>
        <div class="info-grid">
          <div class="info-item">
            <label>Total Machines:</label>
            <span id="info-machines">0</span>
          </div>
          <div class="info-item">
            <label>Total Operators:</label>
            <span id="info-operators">0</span>
          </div>
          <div class="info-item">
            <label>Total Refuel Logs:</label>
            <span id="info-refuels">0</span>
          </div>
          <div class="info-item">
            <label>Database Version:</label>
            <span>v4</span>
          </div>
        </div>
      </div>
    </section>

  </main>

  <!-- Notification Container -->
  <div id="notification-container"></div>

  <script src="app.js"></script>
</body>
</html>